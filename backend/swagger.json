{
  "openapi": "3.0.3",
  "info": {
    "title": "MathKids API",
    "description": "API REST completa do MathKids - Plataforma educativa de matemática para crianças de 3 a 9 anos.\n\nSistema robusto de autenticação, gestão de usuários e recuperação de senhas com segurança avançada.\n\n## ✅ Funcionalidades Implementadas\n- 👥 **Registro de responsáveis/pais** com validação completa\n- 🔑 **Sistema de login seguro** com tokens persistentes ('Lembrar de mim')\n- 🔐 **Redefinição de senha via email** com tokens criptografados\n- 📧 **Serviço de email robusto** (Mailtrap + Ethereal fallback)\n- 🛡️ **Validação rigorosa** e segurança em múltiplas camadas\n- 💾 **PostgreSQL** via Neon.tech com tokens de autenticação\n- 🔍 **Health checks completos** para monitoramento\n- 🚪 **Logout seguro** com revogação de sessões\n- 🔎 **Endpoints de debug** para desenvolvimento\n\n## 🚀 Funcionalidades Futuras\n- 👶 Gestão de perfis de crianças\n- 🧮 Módulos educativos de matemática interativos\n- 🏆 Sistema de progresso e recompensas\n- 📊 Relatórios de aprendizado para pais\n\n## 📧 Sistema de Email\n- **Mailtrap**: Desenvolvimento e produção\n- **Ethereal**: Fallback automático quando Mailtrap falha\n- **Tokens seguros**: 64 chars hex com expiração automática\n- **Templates HTML**: Responsivos e acessíveis\n- **Expiração dinâmica**: 60min (dev) / 15min (prod)\n\n## 🔐 Segurança Avançada\n- **bcrypt**: Senhas hasheadas com salt de 10 rounds\n- **Tokens JWT**: Sessões persistentes seguras\n- **CORS**: Origens específicas permitidas\n- **Validação rigorosa**: Sanitização de todos os inputs\n- **Case-insensitive**: Busca por email normalizada\n- **Logs detalhados**: Monitoramento sem expor dados sensíveis\n\n## 🧪 Como Testar\n1. **Swagger UI**: Acesse esta documentação interativa\n2. **Try it out**: Use os botões para testar diretamente\n3. **Reset de senha**: Execute `/api/forgot-password` → copie token do `devInfo` → teste `/api/reset-password`\n4. **Health checks**: Verifique `/health`, `/health/database`, `/health/email`\n5. **Debug**: Use endpoints `/debug` em desenvolvimento",
    "version": "2.2.0",
    "contact": {
      "name": "MathKids Team",
      "url": "https://github.com/abe-karin/mathkids",
      "email": "contato@mathkids.com"
    },
    "license": {
      "name": "ISC",
      "url": "https://opensource.org/licenses/ISC"
    }
  },
  "servers": [
    {
      "url": "https://mathkids-back.onrender.com",
      "description": "🌐 Servidor de Produção (Render)"
    },
    {
      "url": "http://localhost:5000",
      "description": "🏠 Servidor de desenvolvimento local (porta 5000)"
    },
    {
      "url": "http://localhost:3000",
      "description": "🏠 Servidor alternativo local (porta 3000)"
    }
  ],
  "tags": [
    {
      "name": "Autenticação",
      "description": "Endpoints para registro, login e redefinição de senha de responsáveis/pais"
    },
    {
      "name": "Sistema",
      "description": "Endpoints de monitoramento e health checks da API"
    },
    {
      "name": "Páginas",
      "description": "Rotas para servir páginas HTML do frontend"
    },
    {
      "name": "Debug",
      "description": "Endpoints de debugging e diagnóstico (desenvolvimento apenas)"
    },
    {
      "name": "Educativo",
      "description": "Endpoints para módulos educativos (futuro)"
    }
  ],
  "paths": {
    "/": {
      "get": {
        "tags": ["Páginas"],
        "summary": "Página inicial - Bem-vindo ao Mundo Mágico",
        "description": "Serve a página principal de boas-vindas do MathKids com tema infantil",
        "responses": {
          "200": {
            "description": "Página inicial carregada com sucesso",
            "content": {
              "text/html": {
                "schema": {
                  "type": "string",
                  "example": "<!DOCTYPE html><html><head><title>Bem-vindo ao Mundo Mágico!</title>..."
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": ["Sistema"],
        "summary": "🏥 Verificação de saúde do servidor",
        "description": "Endpoint básico de health check para verificar se o servidor está funcionando corretamente",
        "responses": {
          "200": {
            "description": "✅ Servidor funcionando corretamente",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Servidor saudável",
                    "value": {
                      "status": "OK",
                      "timestamp": "2024-01-15T10:30:00.000Z",
                      "service": "MathKids API"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/health/database": {
      "get": {
        "tags": ["Sistema"],
        "summary": "🗄️ Verificação de conectividade com banco de dados",
        "description": "Verifica se a conexão com o banco de dados PostgreSQL está funcionando corretamente",
        "responses": {
          "200": {
            "description": "✅ Banco de dados conectado e funcionando",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DatabaseHealthResponse"
                },
                "examples": {
                  "success": {
                    "summary": "Banco conectado com sucesso",
                    "value": {
                      "status": "OK",
                      "database": "connected",
                      "timestamp": "2024-01-15T10:30:00.000Z",
                      "query_time": "12ms"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "❌ Erro de conexão com o banco de dados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "database_error": {
                    "summary": "Falha na conexão com banco",
                    "value": {
                      "status": "ERROR",
                      "database": "disconnected",
                      "error": "Connection timeout",
                      "timestamp": "2024-01-15T10:30:00.000Z"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/cadastro": {
      "get": {
        "tags": ["Páginas"],
        "summary": "Página de cadastro de responsáveis",
        "description": "Serve a página de cadastro para pais/responsáveis",
        "responses": {
          "200": {
            "description": "Página de cadastro carregada com sucesso",
            "content": {
              "text/html": {
                "schema": {
                  "type": "string",
                  "example": "<!DOCTYPE html><html><head><title>Cadastro - MathKids</title>..."
                }
              }
            }
          }
        }
      }
    },
    "/api/status": {
      "get": {
        "tags": ["Sistema"],
        "summary": "📊 Status completo da API",
        "description": "Retorna informações detalhadas sobre o status da API, incluindo endpoints disponíveis, banco de dados e serviço de email",
        "responses": {
          "200": {
            "description": "✅ Status da API obtido com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiStatusResponse"
                },
                "examples": {
                  "api_online": {
                    "summary": "API funcionando completamente",
                    "value": {
                      "api": "MathKids API",
                      "status": "online",
                      "endpoints": {
                        "register": "/api/register",
                        "login": "/api/login",
                        "forgot_password": "/api/forgot-password",
                        "reset_password": "/api/reset-password",
                        "docs": "/api-docs",
                        "health": "/health"
                      },
                      "database": "connected",
                      "email_service": {
                        "provider": "mailtrap",
                        "isMailtrap": true,
                        "isTest": false,
                        "fromEmail": "noreply@mathkids.com",
                        "fromName": "MathKids - Educação Infantil",
                        "hasTransporter": true
                      },
                      "timestamp": "2025-10-01T17:30:00.000Z"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/register": {
      "post": {
        "tags": ["Autenticação"],
        "summary": "Registrar novo responsável/pai",
        "description": "Cria uma nova conta para responsável no sistema MathKids.\n\n### Validações Implementadas:\n- ✅ Todos os campos são obrigatórios\n- ✅ Email deve ser único no sistema\n- ✅ Senha é criptografada com bcrypt (10 rounds)\n- ✅ Termos devem ser aceitos (true)\n- ✅ Data de nascimento deve ser válida\n\n### Segurança:\n- 🔐 Senhas hasheadas com bcrypt\n- 🔒 Conexão SSL com PostgreSQL\n- 🛡️ Validação contra SQL injection\n- 📧 Verificação de email duplicado",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegistroRequest"
              },
              "examples": {
                "exemplo_completo": {
                  "summary": "✅ Exemplo de registro completo e válido",
                  "value": {
                    "nomeDoResponsavel": "Maria Silva Santos",
                    "email": "maria.santos@email.com",
                    "senha": "minhasenhasegura123",
                    "dataDeNascimento": "1985-03-15",
                    "termosAceitos": true
                  }
                },
                "exemplo_minimo": {
                  "summary": "✅ Exemplo mínimo válido",
                  "value": {
                    "nomeDoResponsavel": "João",
                    "email": "joao@teste.com",
                    "senha": "123456",
                    "dataDeNascimento": "1990-01-01",
                    "termosAceitos": true
                  }
                },
                "exemplo_erro": {
                  "summary": "❌ Exemplo que gerará erro (email duplicado)",
                  "value": {
                    "nomeDoResponsavel": "Usuário Teste",
                    "email": "usuario@existente.com",
                    "senha": "senha123",
                    "dataDeNascimento": "1988-12-25",
                    "termosAceitos": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "✅ Usuário registrado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RegistroSucessoResponse"
                },
                "examples": {
                  "sucesso": {
                    "summary": "Registro bem-sucedido",
                    "value": {
                      "message": "Usuário registrado com sucesso!",
                      "user": {
                        "id": 42,
                        "email": "maria.santos@email.com",
                        "nome_responsavel": "Maria Silva Santos"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "❌ Dados inválidos ou campos obrigatórios ausentes",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "campos_obrigatorios": {
                    "summary": "Campos obrigatórios faltando",
                    "value": {
                      "message": "Erro: Todos os campos são obrigatórios, incluindo a aceitação dos termos."
                    }
                  },
                  "email_invalido": {
                    "summary": "Email com formato inválido",
                    "value": {
                      "message": "Erro: Email deve ter um formato válido."
                    }
                  },
                  "termos_nao_aceitos": {
                    "summary": "Termos não aceitos",
                    "value": {
                      "message": "Erro: É necessário aceitar os termos de uso."
                    }
                  }
                }
              }
            }
          },
          "409": {
            "description": "❌ Conflito - Email já está em uso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "email_duplicado": {
                    "summary": "Email já cadastrado no sistema",
                    "value": {
                      "message": "Erro: O e-mail fornecido já está em uso."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "❌ Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "erro_servidor": {
                    "summary": "Erro do servidor ou banco de dados",
                    "value": {
                      "message": "Erro interno do servidor ao tentar registrar o usuário."
                    }
                  },
                  "erro_banco": {
                    "summary": "Erro de conexão com banco",
                    "value": {
                      "message": "Erro de conexão com o banco de dados."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/login": {
      "post": {
        "tags": ["Autenticação"],
        "summary": "🔑 Fazer login no sistema",
        "description": "Autentica um usuário registrado no sistema MathKids.\n\n### Credenciais de Teste:\n- **Admin:** `adm@email.com` / `123456`\n- **Usuário:** Use credenciais de um usuário registrado\n\n### Funcionalidades:\n- 🔐 Verificação de senha com bcrypt\n- 🔒 Autenticação segura\n- 💾 Opção de \"Lembrar-me\"\n- 🎯 Redirecionamento automático",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              },
              "examples": {
                "admin_login": {
                  "summary": "👑 Login como Administrador",
                  "value": {
                    "email": "adm@email.com",
                    "senha": "123456",
                    "rememberMe": true
                  }
                },
                "user_login": {
                  "summary": "👤 Login de Usuário Normal",
                  "value": {
                    "email": "maria.santos@email.com",
                    "senha": "minhasenha123",
                    "rememberMe": false
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "✅ Login realizado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginSucessoResponse"
                },
                "examples": {
                  "login_success": {
                    "summary": "Login bem-sucedido",
                    "value": {
                      "message": "Login realizado com sucesso!",
                      "user": {
                        "id": 1,
                        "email": "maria.santos@email.com",
                        "nome": "Maria Silva Santos",
                        "tipo": "usuario"
                      },
                      "token": "token_1_1642234567890",
                      "rememberMe": true
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "❌ Dados inválidos",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "campos_obrigatorios": {
                    "summary": "Campos obrigatórios faltando",
                    "value": {
                      "message": "Erro: Email e senha são obrigatórios."
                    }
                  },
                  "email_invalido": {
                    "summary": "Formato de email inválido",
                    "value": {
                      "message": "Erro: Formato de email inválido."
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "❌ Credenciais inválidas",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "credenciais_incorretas": {
                    "summary": "Email ou senha incorretos",
                    "value": {
                      "message": "Erro: Email ou senha incorretos."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "❌ Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "erro_servidor": {
                    "summary": "Erro do servidor",
                    "value": {
                      "message": "Erro interno do servidor ao tentar fazer login."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/forgot-password": {
      "post": {
        "tags": ["Autenticação"],
        "summary": "🔐 Solicitar redefinição de senha",
        "description": "Solicita um link de redefinição de senha que será enviado por email via Mailtrap.\n\n### 🎯 Para testar o reset-password:\n1. **Execute este endpoint** com um email válido\n2. **Copie o token** do campo `devInfo.resetToken` na resposta\n3. **Use o token** no endpoint `/api/reset-password`\n4. **Ou** copie o link completo do `devInfo.resetLink`\n\n### Funcionalidades:\n- ✅ Verifica se email existe no sistema\n- ✅ Gera token seguro de reset (64 caracteres hex)\n- ✅ Token expira em 60 minutos (dev) / 15 minutos (prod)\n- ✅ Envia email via Mailtrap com link de reset\n- ✅ Fallback para Ethereal em caso de falha\n\n### Segurança:\n- 🔐 Token hasheado com bcrypt antes de salvar\n- ⏰ Expiração automática de tokens\n- 🛡️ Não revela se email existe (mesma resposta)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ForgotPasswordRequest"
              },
              "examples": {
                "usuario_existente": {
                  "summary": "✅ Email válido e cadastrado",
                  "value": {
                    "email": "usuario@email.com"
                  }
                },
                "usuario_inexistente": {
                  "summary": "⚠️ Email não cadastrado (mesma resposta por segurança)",
                  "value": {
                    "email": "naoexiste@email.com"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "✅ Solicitação processada (sempre retorna sucesso por segurança)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ForgotPasswordResponse"
                },
                "examples": {
                  "email_enviado": {
                    "summary": "✅ Email enviado - TOKEN DISPONÍVEL AQUI",
                    "description": "Copie o resetToken do devInfo para usar no /api/reset-password",
                    "value": {
                      "message": "Se este email estiver cadastrado, você receberá instruções para redefinir sua senha.",
                      "resetAvailable": true,
                      "emailSent": true,
                      "devInfo": {
                        "resetToken": "abc123def456...Token64CharsHex...789012345678901234567890abcdef123456",
                        "resetLink": "http://localhost:5000/cadastro/reset-password.html?token=abc123...&email=user%40email.com",
                        "testMode": true,
                        "provider": "mailtrap",
                        "instruction": "🎯 COPIE O resetToken ACIMA para usar no /api/reset-password"
                      }
                    }
                  },
                  "email_nao_encontrado": {
                    "summary": "Email não encontrado (mesma resposta)",
                    "value": {
                      "message": "Se este email estiver cadastrado, você receberá instruções para redefinir sua senha.",
                      "resetAvailable": false
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "❌ Dados inválidos",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "email_obrigatorio": {
                    "summary": "Email não fornecido",
                    "value": {
                      "message": "Email é obrigatório"
                    }
                  },
                  "email_invalido": {
                    "summary": "Formato de email inválido",
                    "value": {
                      "message": "Formato de email inválido"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "❌ Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/reset-password": {
      "post": {
        "tags": ["Autenticação"],
        "summary": "🔄 Redefinir senha com token",
        "description": "Redefine a senha do usuário usando o token recebido por email.\n\n### ⚠️ IMPORTANTE - Como testar:\n1. **Primeiro** execute `/api/forgot-password` com um email válido\n2. **Copie o token** dos logs do servidor ou do campo `devInfo.resetToken`\n3. **Use o token real** neste endpoint (não o exemplo abaixo)\n4. O token de exemplo abaixo **NÃO FUNCIONA** - é apenas ilustrativo\n\n### Validações:\n- ✅ Token deve ser válido e não expirado\n- ✅ Email deve corresponder ao token\n- ✅ Nova senha: 6-128 caracteres\n- ✅ Token é invalidado após uso\n- ✅ Logout em todos os dispositivos\n\n### Segurança:\n- 🔐 Token verificado com bcrypt\n- ⏰ Verificação de expiração\n- 🗑️ Token marcado como usado\n- 🚪 Revoga todas as sessões ativas",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResetPasswordRequest"
              },
              "examples": {
                "reset_valido": {
                  "summary": "⚠️ EXEMPLO ILUSTRATIVO - Use token real do forgot-password",
                  "description": "Este é apenas um exemplo! Execute /api/forgot-password primeiro e use o token retornado.",
                  "value": {
                    "token": "SUBSTITUA_PELO_TOKEN_REAL_DO_FORGOT_PASSWORD_64_CHARS_HEX",
                    "email": "usuario@email.com",
                    "newPassword": "minhanovasenha123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "✅ Senha redefinida com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResetPasswordResponse"
                },
                "examples": {
                  "senha_redefinida": {
                    "summary": "Redefinição bem-sucedida",
                    "value": {
                      "message": "Senha redefinida com sucesso! Faça login com a nova senha."
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "❌ Dados inválidos ou token expirado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "campos_obrigatorios": {
                    "summary": "Campos obrigatórios não fornecidos",
                    "value": {
                      "message": "Token, email e nova senha são obrigatórios"
                    }
                  },
                  "token_invalido": {
                    "summary": "Token inválido ou expirado",
                    "value": {
                      "message": "Token inválido ou expirado"
                    }
                  },
                  "senha_fraca": {
                    "summary": "Senha não atende aos requisitos",
                    "value": {
                      "message": "Nova senha deve ter pelo menos 6 caracteres"
                    }
                  },
                  "email_invalido": {
                    "summary": "Formato de email inválido",
                    "value": {
                      "message": "Formato de email inválido"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "❌ Operação não permitida",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "admin_bloqueado": {
                    "summary": "Tentativa de reset para conta admin",
                    "value": {
                      "message": "Não é possível redefinir senha da conta administrativa"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "❌ Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health/email": {
      "get": {
        "tags": ["Sistema"],
        "summary": "📧 Verificação do serviço de email",
        "description": "Verifica se o serviço de email (Mailtrap/Ethereal) está funcionando corretamente",
        "responses": {
          "200": {
            "description": "✅ Serviço de email funcionando",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EmailHealthResponse"
                },
                "examples": {
                  "mailtrap_ok": {
                    "summary": "Mailtrap funcionando",
                    "value": {
                      "status": "OK",
                      "email_service": "enabled",
                      "provider": "mailtrap",
                      "details": {
                        "provider": "mailtrap",
                        "isMailtrap": true,
                        "isTest": false,
                        "fromEmail": "noreply@mathkids.com",
                        "fromName": "MathKids - Educação Infantil",
                        "hasTransporter": true
                      },
                      "timestamp": "2025-10-01T17:30:00.000Z"
                    }
                  },
                  "ethereal_fallback": {
                    "summary": "Usando Ethereal (fallback)",
                    "value": {
                      "status": "OK",
                      "email_service": "enabled", 
                      "provider": "test",
                      "details": {
                        "provider": "test",
                        "isMailtrap": false,
                        "isTest": true,
                        "fromEmail": "MathKids@exemplo.com",
                        "fromName": "MathKids - Educação Infantil",
                        "hasTransporter": true
                      },
                      "timestamp": "2025-10-01T17:30:00.000Z"
                    }
                  }
                }
              }
            }
          },
          "503": {
            "description": "❌ Serviço de email com problemas",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                },
                "examples": {
                  "email_falhou": {
                    "summary": "Falha no serviço de email",
                    "value": {
                      "status": "ERROR",
                      "email_service": "failed",
                      "error": "SMTP connection failed",
                      "timestamp": "2025-10-01T17:30:00.000Z"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/logout": {
      "post": {
        "tags": ["Autenticação"],
        "summary": "🚪 Logout seguro do usuário",
        "description": "Realiza logout seguro invalidando tokens de autenticação e sessões ativas.\n\n### ✅ Funcionalidades:\n- 🗑️ Invalida token JWT atual\n- 🔄 Remove cookie de 'lembrar de mim'\n- 🛡️ Revoga sessões ativas\n- 📱 Logout em todos os dispositivos\n\n### 🔐 Segurança:\n- Token invalidado instantaneamente\n- Limpeza completa de sessões\n- Sem exposição de dados sensíveis",
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "Token JWT para invalidar (opcional)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "✅ Logout realizado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Logout realizado com sucesso"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/verify-token": {
      "get": {
        "tags": ["Autenticação"],
        "summary": "🔍 Verificar token salvo",
        "description": "Verifica se existe token válido salvo (funcionalidade 'Lembrar de mim').\n\n### ✅ Funcionalidades:\n- 🔍 Verifica cookie de sessão\n- ⏰ Valida expiração do token\n- 👤 Retorna dados do usuário se válido\n- 🔄 Auto-login silencioso\n\n### 🛡️ Segurança:\n- Verificação de integridade do token\n- Validação de expiração\n- Não expõe dados sensíveis",
        "responses": {
          "200": {
            "description": "✅ Token válido encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "valid": {
                      "type": "boolean",
                      "example": true
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer",
                          "example": 123
                        },
                        "email": {
                          "type": "string",
                          "example": "usuario@example.com"
                        },
                        "nome": {
                          "type": "string",
                          "example": "João Silva"
                        },
                        "tipo": {
                          "type": "string",
                          "example": "usuario"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "❌ Token inválido ou expirado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErroResponse"
                }
              }
            }
          }
        }
      }
    },
    "/debug": {
      "get": {
        "tags": ["Debug"],
        "summary": "🔧 Informações de debug do sistema",
        "description": "⚠️ **DESENVOLVIMENTO APENAS** - Retorna informações técnicas do sistema.\n\n### 📊 Informações incluídas:\n- 🌐 URLs e configurações\n- 📧 Status do serviço de email\n- 💾 Conexão com banco de dados\n- ⚙️ Variáveis de ambiente (sem dados sensíveis)\n- 🔍 Estatísticas do servidor\n\n### ⚠️ Importante:\n- Disponível apenas em desenvolvimento\n- Não expõe credenciais\n- Dados sanitizados para segurança",
        "responses": {
          "200": {
            "description": "✅ Informações de debug coletadas",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "environment": {
                      "type": "string",
                      "example": "development"
                    },
                    "database": {
                      "type": "object",
                      "properties": {
                        "connected": {
                          "type": "boolean"
                        },
                        "url_configured": {
                          "type": "boolean"
                        }
                      }
                    },
                    "email": {
                      "type": "object",
                      "properties": {
                        "service": {
                          "type": "string",
                          "example": "mailtrap"
                        },
                        "configured": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "❌ Não disponível em produção"
          }
        }
      }
    },
    "/api/debug/users": {
      "get": {
        "tags": ["Debug"],
        "summary": "👥 Listar usuários (Debug)",
        "description": "⚠️ **DESENVOLVIMENTO APENAS** - Lista usuários cadastrados.\n\n### 📋 Funcionalidades:\n- 📊 Lista todos os usuários\n- 🔒 Senhas são omitidas\n- 📅 Dados de criação e modificação\n- 🔍 Estatísticas básicas\n\n### ⚠️ Segurança:\n- Disponível apenas em desenvolvimento\n- Senhas nunca expostas\n- Dados sensíveis sanitizados",
        "responses": {
          "200": {
            "description": "✅ Lista de usuários",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "users": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "email": {
                            "type": "string"
                          },
                          "nome_responsavel": {
                            "type": "string"
                          },
                          "created_at": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    },
                    "total": {
                      "type": "integer",
                      "example": 42
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "❌ Não disponível em produção"
          }
        }
      }
    },
    "/api/debug/reset-tokens/{email}": {
      "get": {
        "tags": ["Debug"],
        "summary": "🔐 Tokens de reset por email (Debug)",
        "description": "⚠️ **DESENVOLVIMENTO APENAS** - Lista tokens de reset para um email.\n\n### 🔍 Informações incluídas:\n- 📋 Todos os tokens para o email\n- ⏰ Status de expiração\n- 🔄 Tokens usados vs ativos\n- 📅 Datas de criação\n\n### ⚠️ Segurança:\n- Hash dos tokens (não tokens reais)\n- Disponível apenas em desenvolvimento\n- Logs de acesso registrados",
        "parameters": [
          {
            "name": "email",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "email"
            },
            "description": "Email do usuário para buscar tokens"
          }
        ],
        "responses": {
          "200": {
            "description": "✅ Tokens encontrados",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "email": {
                      "type": "string"
                    },
                    "tokens": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "token_hash": {
                            "type": "string",
                            "description": "Hash do token (não o token real)"
                          },
                          "expires_at": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "used": {
                            "type": "boolean"
                          },
                          "created_at": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "❌ Não disponível em produção"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "RegistroRequest": {
        "type": "object",
        "required": [
          "nomeDoResponsavel",
          "email",
          "senha",
          "dataDeNascimento",
          "termosAceitos"
        ],
        "properties": {
          "nomeDoResponsavel": {
            "type": "string",
            "description": "Nome completo do responsável/pai da criança",
            "example": "Maria Silva Santos",
            "minLength": 2,
            "maxLength": 255,
            "pattern": "^[A-Za-zÀ-ÿ\\s]+$"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email único do responsável (usado para login)",
            "example": "maria.santos@email.com",
            "maxLength": 255
          },
          "senha": {
            "type": "string",
            "description": "Senha do usuário (será criptografada com bcrypt)",
            "example": "minhasenhasegura123",
            "minLength": 6,
            "maxLength": 100
          },
          "dataDeNascimento": {
            "type": "string",
            "format": "date",
            "description": "Data de nascimento do responsável no formato YYYY-MM-DD",
            "example": "1985-03-15"
          },
          "termosAceitos": {
            "type": "boolean",
            "description": "Confirmação obrigatória de aceitação dos termos de uso",
            "example": true,
            "enum": [true]
          }
        }
      },
      "RegistroSucessoResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Mensagem de confirmação do registro",
            "example": "Usuário registrado com sucesso!"
          },
          "user": {
            "$ref": "#/components/schemas/UsuarioResponse"
          }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": [
          "email",
          "senha"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email do usuário registrado",
            "example": "maria.santos@email.com"
          },
          "senha": {
            "type": "string",
            "description": "Senha do usuário",
            "example": "minhasenha123",
            "minLength": 3
          },
          "rememberMe": {
            "type": "boolean",
            "description": "Manter usuário logado",
            "example": false,
            "default": false
          }
        }
      },
      "LoginSucessoResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Mensagem de confirmação do login",
            "example": "Login realizado com sucesso!"
          },
          "user": {
            "type": "object",
            "properties": {
              "id": {
                "type": "integer",
                "description": "ID do usuário",
                "example": 1
              },
              "email": {
                "type": "string",
                "format": "email",
                "description": "Email do usuário",
                "example": "maria.santos@email.com"
              },
              "nome": {
                "type": "string",
                "description": "Nome do usuário",
                "example": "Maria Silva Santos"
              },
              "tipo": {
                "type": "string",
                "description": "Tipo de usuário",
                "example": "usuario",
                "enum": ["usuario", "admin"]
              }
            }
          },
          "token": {
            "type": "string",
            "description": "Token de autenticação",
            "example": "token_1_1642234567890"
          },
          "rememberMe": {
            "type": "boolean",
            "description": "Se o usuário escolheu ser lembrado",
            "example": true
          }
        }
      },
      "UsuarioResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID único do usuário no banco PostgreSQL",
            "example": 42
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email do usuário registrado",
            "example": "maria.santos@email.com"
          },
          "nome_responsavel": {
            "type": "string",
            "description": "Nome do responsável cadastrado",
            "example": "Maria Silva Santos"
          }
        }
      },
      "ErroResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Descrição detalhada do erro ocorrido",
            "example": "Erro: Todos os campos são obrigatórios, incluindo a aceitação dos termos."
          }
        }
      },
      "CriancaProfile": {
        "type": "object",
        "description": "Perfil da criança (implementação futura)",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "nome": {
            "type": "string",
            "example": "João Pedro"
          },
          "idade": {
            "type": "integer",
            "minimum": 3,
            "maximum": 9,
            "example": 6
          },
          "nivel_matematica": {
            "type": "string",
            "enum": ["iniciante", "basico", "intermediario"],
            "example": "basico"
          },
          "responsavel_id": {
            "type": "integer",
            "example": 42
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "description": "Status do servidor",
            "example": "OK",
            "enum": ["OK"]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp ISO 8601 da verificação",
            "example": "2024-01-15T10:30:00.000Z"
          },
          "service": {
            "type": "string",
            "description": "Nome do serviço",
            "example": "MathKids API"
          }
        },
        "required": ["status", "timestamp", "service"]
      },
      "DatabaseHealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "description": "Status da conexão com banco",
            "example": "OK",
            "enum": ["OK", "ERROR"]
          },
          "database": {
            "type": "string",
            "description": "Status da conectividade",
            "example": "connected",
            "enum": ["connected", "disconnected"]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp da verificação",
            "example": "2024-01-15T10:30:00.000Z"
          },
          "query_time": {
            "type": "string",
            "description": "Tempo de resposta da consulta de teste",
            "example": "12ms"
          },
          "error": {
            "type": "string",
            "description": "Mensagem de erro (apenas em caso de falha)",
            "example": "Connection timeout"
          }
        },
        "required": ["status", "database", "timestamp"]
      },
      "ForgotPasswordRequest": {
        "type": "object",
        "required": ["email"],
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email do usuário que esqueceu a senha",
            "example": "maria.santos@email.com"
          }
        }
      },
      "DebugResponse": {
        "type": "object",
        "properties": {
          "environment": {
            "type": "string",
            "description": "Ambiente atual (development/production)",
            "example": "development"
          },
          "database": {
            "type": "object",
            "description": "Informações de conexão do banco",
            "properties": {
              "host": {
                "type": "string",
                "example": "ep-dry-lab-a1b2c3d4.us-east-1.aws.neon.tech"
              },
              "port": {
                "type": "string",
                "example": "5432"
              },
              "database": {
                "type": "string",
                "example": "mathkids_db"
              },
              "ssl": {
                "type": "boolean",
                "example": true
              }
            }
          },
          "email": {
            "type": "object",
            "description": "Configurações do serviço de email",
            "properties": {
              "primary": {
                "type": "string",
                "example": "mailtrap"
              },
              "fallback": {
                "type": "string",
                "example": "ethereal"
              }
            }
          },
          "users": {
            "type": "array",
            "description": "Lista de usuários (apenas em development)",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer"
                },
                "email": {
                  "type": "string"
                },
                "nome_responsavel": {
                  "type": "string"
                }
              }
            }
          },
          "resetTokens": {
            "type": "array",
            "description": "Tokens de reset ativos (apenas em development)",
            "items": {
              "type": "object",
              "properties": {
                "email": {
                  "type": "string"
                },
                "token": {
                  "type": "string"
                },
                "expires_at": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          }
        }
      },
      "ForgotPasswordResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Mensagem padrão (sempre a mesma por segurança)",
            "example": "Se este email estiver cadastrado, você receberá instruções para redefinir sua senha."
          },
          "resetAvailable": {
            "type": "boolean",
            "description": "Indica se o reset está disponível (apenas em dev)",
            "example": true
          },
          "emailSent": {
            "type": "boolean",
            "description": "Indica se o email foi enviado (apenas em dev)",
            "example": true
          },
          "devInfo": {
            "type": "object",
            "description": "Informações de desenvolvimento (apenas em NODE_ENV=development)",
            "properties": {
              "resetToken": {
                "type": "string",
                "description": "🎯 Token de reset (64 chars hex) - USE ESTE NO /api/reset-password",
                "example": "abc123def456...Token64CharsHex...789012345678901234567890abcdef123456",
                "minLength": 64,
                "maxLength": 64
              },
              "resetLink": {
                "type": "string",
                "description": "Link completo de reset (apenas em dev)",
                "example": "http://localhost:5000/cadastro/reset-password.html?token=abc123...&email=user%40email.com"
              },
              "testMode": {
                "type": "boolean",
                "description": "Indica se está em modo de teste",
                "example": true
              },
              "provider": {
                "type": "string",
                "description": "Provedor de email usado",
                "example": "mailtrap",
                "enum": ["mailtrap", "ethereal", "test"]
              },
              "previewUrl": {
                "type": "string",
                "description": "URL para preview do email (Ethereal)",
                "example": "https://ethereal.email/message/abc123"
              }
            }
          }
        },
        "required": ["message"]
      },
      "ResetPasswordRequest": {
        "type": "object",
        "required": ["token", "email", "newPassword"],
        "properties": {
          "token": {
            "type": "string",
            "description": "Token de reset recebido por email (64 caracteres hexadecimais)",
            "example": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456",
            "minLength": 64,
            "maxLength": 64,
            "pattern": "^[a-f0-9]{64}$"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email do usuário (deve corresponder ao token)",
            "example": "usuario@email.com"
          },
          "newPassword": {
            "type": "string",
            "description": "Nova senha (6-128 caracteres)",
            "example": "minhanovasenha123",
            "minLength": 6,
            "maxLength": 128
          }
        }
      },
      "ResetPasswordResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string",
            "description": "Mensagem de confirmação",
            "example": "Senha redefinida com sucesso! Faça login com a nova senha."
          }
        },
        "required": ["message"]
      },
      "EmailHealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "description": "Status do serviço de email",
            "example": "OK",
            "enum": ["OK", "UNHEALTHY", "ERROR"]
          },
          "email_service": {
            "type": "string",
            "description": "Estado do serviço",
            "example": "enabled",
            "enum": ["enabled", "failed"]
          },
          "provider": {
            "type": "string",
            "description": "Provedor de email ativo",
            "example": "mailtrap",
            "enum": ["mailtrap", "test"]
          },
          "details": {
            "type": "object",
            "description": "Detalhes do provedor de email",
            "properties": {
              "provider": {
                "type": "string",
                "example": "mailtrap"
              },
              "isMailtrap": {
                "type": "boolean",
                "example": true
              },
              "isTest": {
                "type": "boolean",
                "example": false
              },
              "fromEmail": {
                "type": "string",
                "example": "noreply@mathkids.com"
              },
              "fromName": {
                "type": "string",
                "example": "MathKids - Educação Infantil"
              },
              "hasTransporter": {
                "type": "boolean",
                "example": true
              }
            }
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp da verificação",
            "example": "2025-10-01T17:30:00.000Z"
          },
          "error": {
            "type": "string",
            "description": "Mensagem de erro (apenas em caso de falha)",
            "example": "SMTP connection failed"
          }
        },
        "required": ["status", "email_service", "timestamp"]
      },
      "ApiStatusResponse": {
        "type": "object",
        "properties": {
          "api": {
            "type": "string",
            "description": "Nome da API",
            "example": "MathKids API"
          },
          "status": {
            "type": "string",
            "description": "Status geral da API",
            "example": "online",
            "enum": ["online", "degraded", "offline"]
          },
          "endpoints": {
            "type": "object",
            "description": "Lista de endpoints principais disponíveis",
            "properties": {
              "register": {
                "type": "string",
                "example": "/api/register"
              },
              "login": {
                "type": "string",
                "example": "/api/login"
              },
              "forgot_password": {
                "type": "string",
                "example": "/api/forgot-password"
              },
              "reset_password": {
                "type": "string",
                "example": "/api/reset-password"
              },
              "docs": {
                "type": "string",
                "example": "/api-docs"
              },
              "health": {
                "type": "string",
                "example": "/health"
              }
            }
          },
          "database": {
            "type": "string",
            "description": "Status da conexão com banco de dados",
            "example": "connected",
            "enum": ["connected", "not configured", "disconnected"]
          },
          "email_service": {
            "type": "object",
            "description": "Informações do serviço de email",
            "properties": {
              "provider": {
                "type": "string",
                "example": "mailtrap"
              },
              "isMailtrap": {
                "type": "boolean",
                "example": true
              },
              "isTest": {
                "type": "boolean",
                "example": false
              },
              "fromEmail": {
                "type": "string",
                "example": "noreply@mathkids.com"
              },
              "fromName": {
                "type": "string",
                "example": "MathKids - Educação Infantil"
              },
              "hasTransporter": {
                "type": "boolean",
                "example": true
              }
            }
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp da consulta",
            "example": "2025-10-01T17:30:00.000Z"
          }
        },
        "required": ["api", "status", "timestamp"]
      }
    },
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Token JWT para autenticação (implementação futura para login)"
      }
    }
  },
  "security": [],
  "externalDocs": {
    "description": "📚 Documentação completa do MathKids no GitHub\n\n🚀 **Início Rápido**\n1. Clone o repositório\n2. Configure as variáveis de ambiente (.env)\n3. Execute `npm install && npm start`\n4. Acesse /api-docs para esta documentação\n\n🔧 **Configuração de Desenvolvimento**\n- PostgreSQL via Neon.tech (DATABASE_URL)\n- Mailtrap para emails (MAILTRAP_USERNAME/PASSWORD)\n- NODE_ENV=development para logs detalhados\n\n📧 **Testando Emails**\n- Use /api/forgot-password → copie token do devInfo\n- Execute /api/reset-password com o token\n- Logs detalhados em desenvolvimento\n\n🛡️ **Segurança**\n- Senhas hasheadas com bcrypt (10 rounds)\n- Tokens de 64 chars hex para reset\n- Validação rigorosa em todas as entradas\n- CORS configurado para origens específicas\n\n📊 **Monitoramento**\n- /health → Status geral da API\n- /health/database → Conectividade do banco\n- /health/email → Status do serviço de email\n- /debug → Informações detalhadas (apenas dev)\n\n🎯 **Próximos Passos**\n- Implementar módulos educativos de matemática\n- Adicionar gestão de perfis de crianças\n- Sistema de progresso e recompensas\n- Relatórios de aprendizado para pais",
    "url": "https://github.com/abe-karin/mathkids/blob/main/README.md"
  }
}