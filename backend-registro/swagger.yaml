openapi: 3.0.3
info:
  title: MathKids API
  description: |
    API do MathKids - Aplicativo de ensino de matem치tica para crian칞as de 3 a 9 anos.
    
    Esta API gerencia o sistema de autentica칞칚o de respons치veis e futuramente incluir치
    endpoints para m칩dulos educativos, progresso das crian칞as e gamifica칞칚o.
    
    ## Funcionalidades Atuais
    - Registro de respons치veis/pais
    - Sistema de autentica칞칚o seguro
    - Valida칞칚o de dados
    
    
  version: 1.0.0
  contact:
    name: MathKids Team
    url: https://github.com/abe-karin/mathkids
  license:
    name: ISC
    url: https://opensource.org/licenses/ISC

servers:
  - url: https://mathkids-back.onrender.com
    description: 游깷 Servidor de Produ칞칚o (Render)
  - url: http://localhost:5000
    description: 游 Servidor de desenvolvimento local
  - url: http://localhost:3000
    description: 游 Servidor alternativo local

tags:
  - name: Autentica칞칚o
    description: Endpoints para registro e login de respons치veis
  - name: P치ginas
    description: Rotas para servir p치ginas HTML do frontend

paths:
  /:
    get:
      tags:
        - P치ginas
      summary: P치gina inicial
      description: Serve a p치gina principal de boas-vindas do MathKids
      responses:
        '200':
          description: P치gina inicial carregada com sucesso
          content:
            text/html:
              schema:
                type: string
                example: "<!DOCTYPE html>..."

  /health:
    get:
      tags:
        - Sistema
      summary: Verifica칞칚o de sa칰de do servidor
      description: Endpoint b치sico de health check para verificar se o servidor est치 funcionando
      responses:
        '200':
          description: Servidor funcionando corretamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /health/database:
    get:
      tags:
        - Sistema
      summary: Verifica칞칚o de conectividade com banco
      description: Verifica se a conex칚o com PostgreSQL est치 funcionando
      responses:
        '200':
          description: Banco de dados conectado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseHealthResponse'
        '500':
          description: Erro de conex칚o com banco
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErroResponse'

  /cadastro:
    get:
      tags:
        - P치ginas
      summary: P치gina de cadastro
      description: Serve a p치gina de cadastro de respons치veis
      responses:
        '200':
          description: P치gina de cadastro carregada com sucesso
          content:
            text/html:
              schema:
                type: string
                example: "<!DOCTYPE html>..."

  /api/register:
    post:
      tags:
        - Autentica칞칚o
      summary: Registrar novo respons치vel
      description: |
        Cria uma nova conta para respons치vel/pai no sistema MathKids.
        
        ## Valida칞칫es:
        - Todos os campos s칚o obrigat칩rios
        - Email deve ser 칰nico no sistema
        - Senha 칠 criptografada com bcrypt (10 rounds)
        - Termos devem ser aceitos (true)
        
        ## Seguran칞a:
        - Senhas s칚o hasheadas com bcrypt
        - Conex칚o SSL com banco PostgreSQL
        - Valida칞칚o de duplicidade de email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegistroRequest'
            examples:
              exemplo_completo:
                summary: Exemplo de registro completo
                value:
                  nomeDoResponsavel: "Maria Silva Santos"
                  email: "maria.santos@email.com"
                  senha: "minhasenha123"
                  dataDeNascimento: "1985-03-15"
                  termosAceitos: true
              exemplo_minimo:
                summary: Exemplo m칤nimo v치lido
                value:
                  nomeDoResponsavel: "Jo칚o"
                  email: "joao@teste.com"
                  senha: "123456"
                  dataDeNascimento: "1990-01-01"
                  termosAceitos: true
      responses:
        '201':
          description: Usu치rio registrado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegistroSucessoResponse'
              examples:
                sucesso:
                  summary: Registro bem-sucedido
                  value:
                    message: "Usu치rio registrado com sucesso!"
                    user:
                      id: 42
                      email: "maria.santos@email.com"
                      nome_responsavel: "Maria Silva Santos"
        '400':
          description: Dados inv치lidos ou campos obrigat칩rios ausentes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErroResponse'
              examples:
                campos_obrigatorios:
                  summary: Campos obrigat칩rios faltando
                  value:
                    message: "Erro: Todos os campos s칚o obrigat칩rios, incluindo a aceita칞칚o dos termos."
                email_invalido:
                  summary: Email inv치lido
                  value:
                    message: "Erro: Email deve ter um formato v치lido."
        '409':
          description: Email j치 est치 em uso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErroResponse'
              examples:
                email_duplicado:
                  summary: Email j치 cadastrado
                  value:
                    message: "Erro: O e-mail fornecido j치 est치 em uso."
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErroResponse'
              examples:
                erro_servidor:
                  summary: Erro do servidor
                  value:
                    message: "Erro interno do servidor ao tentar registrar o usu치rio."

components:
  schemas:
    RegistroRequest:
      type: object
      required:
        - nomeDoResponsavel
        - email
        - senha
        - dataDeNascimento
        - termosAceitos
      properties:
        nomeDoResponsavel:
          type: string
          description: Nome completo do respons치vel/pai
          example: "Maria Silva Santos"
          minLength: 2
          maxLength: 255
        email:
          type: string
          format: email
          description: Email 칰nico do respons치vel
          example: "maria.santos@email.com"
          maxLength: 255
        senha:
          type: string
          description: Senha do usu치rio (ser치 criptografada)
          example: "minhasenha123"
          minLength: 6
          maxLength: 100
        dataDeNascimento:
          type: string
          format: date
          description: Data de nascimento do respons치vel
          example: "1985-03-15"
        termosAceitos:
          type: boolean
          description: Confirma칞칚o de aceita칞칚o dos termos de uso
          example: true
          enum: [true]

    RegistroSucessoResponse:
      type: object
      properties:
        message:
          type: string
          description: Mensagem de confirma칞칚o
          example: "Usu치rio registrado com sucesso!"
        user:
          $ref: '#/components/schemas/UsuarioResponse'

    UsuarioResponse:
      type: object
      properties:
        id:
          type: integer
          description: ID 칰nico do usu치rio no banco de dados
          example: 42
        email:
          type: string
          format: email
          description: Email do usu치rio
          example: "maria.santos@email.com"
        nome_responsavel:
          type: string
          description: Nome do respons치vel
          example: "Maria Silva Santos"

    HealthResponse:
      type: object
      required:
        - status
        - timestamp
        - service
      properties:
        status:
          type: string
          enum: [OK]
          description: Status do servidor
          example: "OK"
        timestamp:
          type: string
          format: date-time
          description: Timestamp da verifica칞칚o
          example: "2024-01-15T10:30:00.000Z"
        service:
          type: string
          description: Nome do servi칞o
          example: "MathKids API"

    DatabaseHealthResponse:
      type: object
      required:
        - status
        - database
        - timestamp
      properties:
        status:
          type: string
          enum: [OK, ERROR]
          description: Status da conex칚o
          example: "OK"
        database:
          type: string
          enum: [connected, disconnected]
          description: Status da conectividade
          example: "connected"
        timestamp:
          type: string
          format: date-time
          description: Timestamp da verifica칞칚o
          example: "2024-01-15T10:30:00.000Z"
        query_time:
          type: string
          description: Tempo de resposta da consulta
          example: "12ms"
        error:
          type: string
          description: Mensagem de erro (apenas em falhas)
          example: "Connection timeout"

    ErroResponse:
      type: object
      properties:
        message:
          type: string
          description: Descri칞칚o detalhada do erro
          example: "Erro: Todos os campos s칚o obrigat칩rios, incluindo a aceita칞칚o dos termos."

  securitySchemes:
    # Para futuras implementa칞칫es de autentica칞칚o
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Token JWT para autentica칞칚o (implementa칞칚o futura)

# Configura칞칫es globais
security: []

# Informa칞칫es adicionais sobre a API
externalDocs:
  description: Documenta칞칚o completa do MathKids
  